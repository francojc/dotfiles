#!/usr/bin/env bash
# Fetch available GitHub Copilot models and print IDs

SCRIPT_NAME="gh-cop-models"; SCRIPT_VERSION="1.0.0"
. "$(dirname "$0")/common"

usage(){ cat <<EOF
Usage: gh-cop-models

Fetch available Copilot models using GITHUB_COPILOT_API_KEY (as required by endpoint).
EOF
}

main(){
  local show_help=0 show_version=0
  local OPTIND=1 opt
  while getopts ":hvq-:" opt; do
    case "$opt" in
      h) show_help=1 ;;
      v) VERBOSE=$((VERBOSE+1)) ;;
      q) QUIET=1 ;;
      -) case "$OPTARG" in version) show_version=1 ;; *) die "Unknown long option --$OPTARG";; esac ;;
      \?) die "Unknown option -$OPTARG" ;;
    esac
  done
  shift $((OPTIND-1)) || true
  [[ $show_help -eq 1 ]] && { usage; exit 0; }
  [[ $show_version -eq 1 ]] && { print_version; exit 0; }

  require curl jq
  [[ -n "${OPENAI_API_KEY:-}" ]] || die "OPENAI_API_KEY not set"

  run curl -s https://api.githubcopilot.com/models \
    -H "Authorization: Bearer $GITHUB_COPILOT_API_KEY" \
    -H "Content-Type: application/json" \
    -H "Copilot-Integration-Id: vscode-chat" | jq -r '.data[].id'
}

main "$@"
