#!/usr/bin/env bash
# Quarto preview watcher wrapper

SCRIPT_NAME="q-prev"; SCRIPT_VERSION="1.0.0"
. "$(dirname "$0")/common"

usage(){ cat <<EOF
Usage: q-prev [options]

Run Quarto preview (delegates to preview_watch).
EOF
}

main(){
  # shellcheck disable=SC2046
  set -- $(canonicalize_long_opts "$@")
  local show_help=0 show_version=0
  local OPTIND=1 opt
  while getopts ":hvq-:" opt; do
    case "$opt" in
      h) show_help=1 ;;
      v) VERBOSE=$((VERBOSE+1)) ;;
      q) QUIET=1 ;;
      -) case "$OPTARG" in version) show_version=1 ;; *) die "Unknown long option --$OPTARG";; esac ;;
      \?) die "Unknown option -$OPTARG" ;;
    esac
  done
  shift $((OPTIND-1)) || true
  [[ $show_help -eq 1 ]] && { usage; exit 0; }
  [[ $show_version -eq 1 ]] && { print_version; exit 0; }

  if command -v preview_watch >/dev/null 2>&1; then
    run preview_watch "$@"
  elif [[ -x "$(dirname "$0")/preview_watch" ]]; then
    run "$(dirname "$0")/preview_watch" "$@"
  else
    die "preview_watch not found"
  fi
}

main "$@"
